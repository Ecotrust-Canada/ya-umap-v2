<!doctype html>

<html><head>

<title>Riot todo</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<link rel="stylesheet" href="../css/ya.css">
<link rel="stylesheet" href="../vendor/leaflet/dist/leaflet.css" />
<link rel="stylesheet" href="../vendor/leaflet.markercluster/dist/MarkerCluster.css" />
<link rel="stylesheet" href="../vendor/leaflet.markercluster/dist/MarkerCluster.Default.css" />

</head><body>

<layers></layers>

<script src="/tags/layers.tag" type="riot/tag"></script>
<!-- Example data. -->
<script src="https://www.mapbox.com/mapbox.js/assets/data/realworld.388.js"></script>
<script src="../vendor/riot/riot%2Bcompiler.min.js"></script>
<script src="//cdn.rawgit.com/fdaciuk/ajax/v1.0.10/dist/ajax.min.js"></script>
<script src="../vendor/leaflet/dist/leaflet-src.js"></script>
<script src="../vendor/leaflet.markercluster/dist/leaflet.markercluster.js"></script>

<div id='map'></div>

<script>

	var map = L.map('map', {
		center: [49.505, -123],
		zoom: 10
	});
		
var OpenStreetMap_BlackAndWhite = L.tileLayer('http://{s}.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png', {
	maxZoom: 18,
	attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
});

	map.addLayer(OpenStreetMap_BlackAndWhite);

	var markers = new L.MarkerClusterGroup();

	for (var i = 0; i < 5; i++) {
		var title = 'x';
		var marker = L.marker(new L.LatLng(49.505, -123.09), {
			icon: L.icon({
			    iconUrl: 'public/pin.png',
				iconSize: [38, 95],
				iconAnchor: [22, 94],
				popupAnchor: [-3, -76]
			}),
			title: title
		});
		marker.bindPopup(title);
		markers.addLayer(marker);
	}

	map.addLayer(markers);

  bounds = map.getBounds();
  url = "parks/within?lat1=" + bounds.getSouthWest().lat + "&lon1=" + bounds.getSouthWest().lng + "&lat2=" + bounds.getNorthEast().lat + "&lon2=" + bounds.getNorthEast().lng;	
	


var geo;
 
function getPins(e){
	if (geo) map.removeLayer(geo);
	var bounds = map.getBounds();
	var url = "soil/within?lat1=" + bounds.getSouthWest().lat + "&lon1=" + bounds.getSouthWest().lng + "&lat2=" + bounds.getNorthEast().lat + "&lon2=" + bounds.getNorthEast().lng;
	var request = ajax().get(url).then(function(response){
		geo = {
			"type": "FeatureCollection",
			"features": JSON.parse(response)
		}
		geo = L.geoJson(geo, {
			style:{
				"color": "#ff7800",
				"weight": 5,
				"opacity": 0.65
			}
		}).addTo(map);
	});
}
 


map.on('dragend', getPins);
map.on('zoomend', getPins);
map.whenReady(getPins);


riot.mount('todo', {
  title: 'I want to behave!',
  items: [
	{ title: 'Avoid excessive caffeine', done: true },
	{ title: 'Hidden item',  hidden: true },
	{ title: 'Be less provocative'  },
	{ title: 'Be nice to people' }
  ]
})
</script>
</body></html>
